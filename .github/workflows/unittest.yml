# ************************************************************************
#  @author:     Andreas Kaeberlein
#  @copyright:  Copyright 2021
#  @credits:    AKAE
#
#  @license:    BSDv3
#  @maintainer: Andreas Kaeberlein
#  @email:      andreas.kaeberlein@web.de
#
#  @file:       unittest.yml
#  @date:       2021-08-25
#
#  @brief:      runs test and deploy
#
# ************************************************************************


name: Unittest

on:
  push:
    paths-ignore:
      - 'doc/**'
      - 'README.md'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: ghdl/setup-ghdl-ci@nightly
        with:
          backend: mcode
      - name: Prepare
        run: |
          ghdl --version
          mkdir -p ./sim/work
      - name: generic_spi_master_inp_filter
        run: |
          ghdl -a --std=93c --ieee=synopsys --time-resolution=ps --workdir=./sim/work ./hdl/generic_spi_master_inp_filter.vhd
          ghdl -a --std=93c --ieee=synopsys --time-resolution=ps --workdir=./sim/work ./tb/generic_spi_master_inp_filter_tb.vhd
          ((ghdl -r --std=93c --ieee=synopsys --time-resolution=ps --workdir=./sim/work generic_spi_master_inp_filter_tb -gDO_ALL_TEST=True) || if [ $? -ne 0 ]; then echo "[ FAIL ]   eSpiStaticSlave"; exit 1; fi)

